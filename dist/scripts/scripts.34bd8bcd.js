"use strict";angular.module("weatherApp",["ngResource","ngRoute","localytics.directives","LocalStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]),angular.module("weatherApp").controller("MainCtrl",["Weather",function(a){function b(a){for(var b=a?a:g.location.state,c=g.states.length,d=0;c>d;d++)if(g.states[d].initials===b)return g.activeState=g.states[d]}function c(){g.location=a.defaultOptions()}function d(){a.states().then(function(a){var c=a.data;g.states=c.states,b(g.location.state),e()})}function e(b){g.location.remember=a.checkData(g.location),g.location.city&&a.forecast(g.location.state,g.location.city).then(function(b){g.forecast=b,g.minMax=a.minMax(b.previsoes),g.weekend=a.weekend(b.previsoes),g.chart=a.chart(b.previsoes),g.error=!1},function(a){g.error=a})}function f(b){a.toggle(g.location,b)}var g=this;g.setState=b,g.getForecast=e,g.toggleStorage=f,c(),d()}]),angular.module("weatherApp").factory("Weather",["$http","$q","localStorageService",function(a,b,c){function d(c,d){var e=b.defer();return a.get(o+d+"-"+c).then(function(a){a.data.hasOwnProperty("erro")?e.reject(a.data.erro):(n=a.data,e.resolve(n))},function(){e.reject("Houve algum problema com a conexão.")}),e.promise}function e(){var a=b.defer();return a.resolve(c.get("resultData")),a.promise}function f(){return{city:q,state:r,remember:c.length()>0}}function g(a,b){var f=c.get("expire"),g=(new Date).getTime(),h=g-f;return c.get("city")==b&&12e5>h?e():d(a,b)}function h(){return a.get(p+"states-cities.json")}function i(a){var b={};return b.min=a.reduce(function(a,b){return a.temperatura_min<=b.temperatura_min?a:b}),b.max=a.reduce(function(a,b){return a.temperatura_max>=b.temperatura_max?a:b}),b}function j(a){var b=/^(Domingo|Sábado|Sexta)/,c=0,d=a.filter(function(a){return b.test(a.data)}),e=d.length;if(!(1>e)){for(var f=0;e>f;f++)c+=parseInt(d[f].temperatura_max);return{is:c/e>s,value:c/e}}}function k(a){return a.map(function(a){var b=a.data.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/),c=b?new Date(b[3],b[2]-1,b[1]):null,d=c.getDate(),e=c.getMonth()+1,f=c.getFullYear();return{data:f+"-"+e+"-"+d,min:parseInt(a.temperatura_min),max:parseInt(a.temperatura_max)}})}function l(a,b){b?(c.set("resultData",n),c.set("city",a.city),c.set("state",a.state),c.set("expire",(new Date).getTime())):c.remove("resultData","city","state","expire")}function m(a){return a.city==c.get("city")&&c.length()>0}var n,o="//developers.agenciaideias.com.br/tempo/json/",p="data/",q=c.get("city")||"Blumenau",r=c.get("state")||"SC",s=25,t={defaultOptions:f,forecast:g,states:h,minMax:i,weekend:j,chart:k,toggle:l,checkData:m};return t}]),angular.module("weatherApp").directive("loading",["$http",function(a){return{restrict:"A",link:function(b,c,d){b.isLoading=function(){return a.pendingRequests.length>0},b.$watch(b.isLoading,function(a){a?c.show():c.hide()})}}}]),angular.module("weatherApp").directive("lineChart",function(){return{restrict:"A",scope:{lineData:"=",lineXkey:"@",lineYkeys:"=",lineLabels:"=",lineColors:"="},link:function(a,b){function c(a){var b;return b=b instanceof Date?a:new Date(a),("0"+b.getDate()).slice(-2)+"/"+("0"+(b.getMonth()+1)).slice(-2)}a.$watch("lineData",function(){a.lineData&&("string"==typeof a.lineData&&(a.lineData=JSON.parse(a.lineData)),"string"==typeof a.lineYkeys&&(a.lineYkeys=JSON.parse(a.lineYkeys)),"string"==typeof a.lineYkeys&&(a.lineYkeys=JSON.parse(a.lineYkeys)),"string"==typeof a.lineLabels&&(a.lineLabels=JSON.parse(a.lineLabels)),"string"==typeof a.lineColors&&(a.lineColors=JSON.parse(a.lineColors)),a.lineInstance?a.lineInstance.setData(a.lineData):a.lineInstance=new Morris.Line({element:b,data:a.lineData,xkey:a.lineXkey,ykeys:a.lineYkeys,labels:a.lineLabels,resize:!0,postUnits:"ºC",lineColors:a.lineColors||["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],xLabelFormat:function(a){return c(a)},dateFormat:function(a){return c(a)}}))})}}}),angular.module("weatherApp").run(["$templateCache",function(a){a.put("views/main.html",'<section class="content-header"> <h1>Previsão do tempo</h1> </section> <section class="content content-all"> <div class="overlay-all" data-loading> <i class="glyphicon glyphicon-refresh glyphicon-spin"></i> </div> <div class="box box-default"> <div class="box-header with-border"> <h3 class="box-title">Opções</h3> </div> <div class="box-body"> <div class="row"> <div class="col-lg-3 col-sm-4 col-xs-12"> <select chosen class="form-control chosen-select" ng-model="main.location.state" ng-options="state.initials as state.name for state in main.states" ng-change="main.setState(main.location.state)"> <option value="">Selecione o seu estado</option> </select> </div> <div class="col-lg-3 col-sm-4 col-xs-12"> <select chosen class="form-control" ng-model="main.location.city" ng-options="city as city for city in main.activeState.cities track by city" ng-change="main.getForecast()"> <option value="">Selecione a sua cidade</option> </select> </div> <div class="col-md-4 col-xs-12"> <input type="checkbox" ng-disabled="main.error" ng-model="main.location.remember" ng-value="remember" ng-change="main.toggleStorage(main.location.remember)"> Lembrar </div> </div> </div><!-- /.box-body --> </div> <div class="row" ng-if="main.error"> <div class="col-xs-12"> <div class="alert alert-danger alert-dismissible"> <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button> <h4><i class="glyphicon glyphicon-alert"></i> Ops!</h4> {{main.error}} </div> </div> </div> <div class="row" ng-if="!main.error"> <div class="col-xs-12" ng-show="main.forecast"> <h1 class="h2">Tempo para: {{ main.forecast.cidade }}</h1> <span>Última atualização: {{main.forecast.agora.data_hora}}</span> <div class="row-no-padding box-weather-wrapper"> <div class="box-weather col-xs-12 col-sm-4"> <div class="box box-success"> <div class="box-header with-border"> <h3 class="box-title">{{main.forecast.agora.descricao}}</h3> <p class="box-date">{{main.forecast.previsoes[0].data}}</p> </div> <div class="box-body"> <img ng-src="{{main.forecast.agora.imagem}}" class="center-block" alt=""> <h2 class="temp-now">{{main.forecast.agora.temperatura}} ºC</h2> <div class="max-and-min"> <span class="max-temp"> <i class="glyphicon glyphicon-arrow-up text-red"></i> {{main.forecast.previsoes[0].temperatura_max}} ºC </span> <span class="min-temp"> <i class="glyphicon glyphicon-arrow-down text-light-blue"></i> {{main.forecast.previsoes[0].temperatura_min}} ºC </span> </div> </div> </div> </div> <div class="box-weather col-xs-6 col-sm-4 col-md-2" ng-repeat="ft in main.forecast.previsoes" ng-if="!$first"> <div class="box"> <div class="box-header with-border"> <h3 class="box-title">{{ft.descricao}}</h3> <p class="box-date">{{ft.data}}</p> </div> <div class="box-body"> <img ng-src="{{ft.imagem}}" class="center" alt=""> <span class="max-temp"> <i class="glyphicon glyphicon-arrow-up text-red"></i> {{ft.temperatura_max}} ºC </span> <span class="min-temp"> <i class="glyphicon glyphicon-arrow-down text-light-blue"></i> {{ft.temperatura_min}} ºC </span> </div> </div> </div> </div> </div> </div> <div class="row box-flex" ng-if="!main.error"> <div ng-show="main.minMax.max && main.minMax.min" class="col-xs-12 col-md-4"> <div class="box"> <div class="box-header with-border"> <h3 class="box-title">Mínima e Máxima</h3> <p>Em {{main.forecast.cidade}}</p> </div> <div class="box-body"> <div class="row"> <div class="col-xs-6 text-center"> <p>{{main.minMax.min.data}}</p> <img ng-src="{{main.minMax.min.imagem}}" alt=""> <span class="min-temp"> <i class="glyphicon glyphicon-arrow-down text-light-blue"></i> {{main.minMax.min.temperatura_min}} ºC </span> </div> <div class="col-xs-6 text-center"> <p>{{main.minMax.max.data}}</p> <img ng-src="{{main.minMax.max.imagem}}" alt=""> <span class="max-temp"> <i class="glyphicon glyphicon-arrow-up text-red"></i> {{main.minMax.max.temperatura_max}} ºC </span> </div> </div> </div> </div> </div> <div class="col-xs-12 col-md-4" ng-if="!main.weekend.is && main.weekend"> <div class="box box-image box-image-home"> <div class="box-header"> <h3 class="box-title">Quem sabe um Netflix?</h3> </div> <div class="box-body"> <p>A previsão para o final de semana é de uma temperatura máxima média de:</p> <span class="min-temp weekend big center-block text-center"> <i class="glyphicon glyphicon-arrow-up text-red"></i> {{main.weekend.value}} ºC </span> </div> </div> </div> <div class="col-xs-12 col-md-4" ng-if="main.weekend.is && main.weekend"> <div class="box box-image box-image-beach"> <div class="box-header"> <h3 class="box-title">Vai dar praia!</h3> </div> <div class="box-body"> <p>As previsões indicam que a temperatura máxima média é de:</p> <span class="max-temp weekend big center-block text-center"> <i class="glyphicon glyphicon-arrow-up text-red"></i> {{main.weekend.value}} ºC </span> </div> </div> </div> <div class="col-xs-12 col-md-4" ng-if="main.chart"> <div class="box"> <div class="box-header with-border"> <h3 class="box-title">Variação da Temperatura</h3> </div> <div class="box-body box-chart"> <div class="line-chart" line-chart line-data="main.chart" line-xkey="data" line-ykeys="[\'max\', \'min\']" line-labels="[\'Temperatura Máxima\', \'Temperatura Mínima\']" line-colors="[\'#DD4B39\', \'#3C8DBC\']"> </div> </div> </div> </div> </div></section>')}]);